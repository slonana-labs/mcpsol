# Data Model: Optimize Compute Unit Usage

## Overview

This feature is a performance optimization that does not introduce new persistent data structures. The "entities" here represent internal caching structures that exist only in program memory.

## Internal Structures

### CachedSchema

Pre-computed schema pages stored in static memory for builder-pattern programs.

**Purpose**: Avoid re-serializing schema JSON on every `list_tools` call

**Fields**:
- `pages: Vec<Vec<u8>>` - Pre-serialized JSON bytes for each pagination page
- Each page is ≤1024 bytes (Solana return_data limit)

**Lifecycle**:
- Created on first `list_tools` call via `OnceLock::get_or_init()`
- Lives for program lifetime
- Never modified after initialization

**Memory Budget**:
- Typical program with 4 tools: 4 pages × ~500 bytes = ~2KB
- Maximum (10+ tools): ~10KB

### SchemaByteConstant

Compile-time schema bytes for macro-based programs.

**Purpose**: Zero-cost schema access via static byte slice

**Fields**:
- `MCP_SCHEMA_BYTES: &'static [u8]` - Complete schema as byte literal

**Generated by**: `#[mcp_program]` macro

**Size**: Same as current `MCP_SCHEMA_JSON` string, ≤1024 bytes for non-paginated

## State Transitions

```
┌─────────────────┐
│   Uninitialized │
│  (program load) │
└────────┬────────┘
         │
         │ First list_tools call
         v
┌─────────────────┐
│   Initialized   │
│ (pages cached)  │
└────────┬────────┘
         │
         │ Subsequent calls
         v
┌─────────────────┐
│   Cache Hit     │
│ (copy to ret)   │
└─────────────────┘
```

## No External Contracts

This feature does not modify any external APIs or data formats:
- Schema JSON format: **unchanged**
- `list_tools` instruction interface: **unchanged**
- Pagination protocol: **unchanged**

The optimization is entirely internal to the library implementation.
